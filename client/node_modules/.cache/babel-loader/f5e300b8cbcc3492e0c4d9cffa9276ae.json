{"ast":null,"code":"var _jsxFileName = \"C:\\\\Users\\\\Mike\\\\my-app\\\\client\\\\src\\\\App.js\",\n    _s = $RefreshSig$();\n\nimport React from \"react\";\nimport Header from \"./components/Header\";\nimport Main from \"./components/Main\";\nimport { useEffect, useState, useContext, useRef } from \"react\";\nimport { UserContext } from \"./UserContext\";\nimport axios from \"axios\";\nimport { accessToken, getCurrentUserProfile, getUserTopTracks, getUserTopArtists } from \"./spotify\";\nimport { catchErrors } from \"./utils\";\nimport { BrowserRouter as Router } from \"react-router-dom\";\nimport LandingPage from \"./components/pages/LandingPage\";\nimport { ErrorBoundary } from \"react-error-boundary\";\nimport findUser from \"./axios-api\";\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nexport default function App() {\n  _s();\n\n  const [firstName, setFirstName] = useState(\"\");\n  const [profilePhoto, setProfilePhoto] = useState(\"\");\n  const [country, setCountry] = useState(\"\");\n  const [topTrack, setTopTrack] = useState(\"\");\n  const [artist, setArtist] = useState(\"\");\n  const [artistImage, setArtistImage] = useState(\"\");\n  const [artistId, setArtistId] = useState(\"\");\n  const [genre, setGenre] = useState([]);\n  const [previewUrl, setPreviewUrl] = useState(\"\");\n  const [albumCover, setAlbumCover] = useState(\"\");\n  const [isPlaying, setIsPlaying] = React.useState(false);\n  const [topSongs, setTopSongs] = useState([{\n    song: \"\",\n    artist: \"\",\n    albumCover: \"\",\n    preview: \"\"\n  }]);\n  const [similarArtists, setSimilarArtists] = useState(null);\n  const [points, setPoints] = useState(2);\n  const [currentlyPlaying, setCurrentlyPlaying] = useState(null);\n  const [email, setEmail] = useState(null);\n  const [token, setToken] = useState(\"\");\n  const [justLoggedIn, setJustLoggedIn] = useState(false);\n  const componentIsMounted = useRef(true); // const navigate = useNavigate()\n  // useEffect(() => {\n  //   return() => {\n  //     componentIsMounted.current = false\n  //   }\n  // })\n\n  useEffect(() => {\n    window.history.pushState({}, null, \"/\");\n  }, [token]);\n\n  const fetchData = async () => {\n    try {\n      if (!isCancelled) {\n        // axios.defaults.baseURL = 'https://api.spotify.com/v1'\n        const {\n          data\n        } = await getCurrentUserProfile();\n        const fullName = data.display_name;\n        const nameArray = fullName.split(' ');\n        const firstName = nameArray[0];\n        setFirstName(firstName);\n        const profPic = data.images[0].url;\n        setProfilePhoto(profPic);\n        const location = data.country;\n        setCountry(location);\n        setEmail(data.email);\n      }\n    } catch (e) {\n      if (!isCancelled) {\n        console.error(e);\n      }\n    }\n\n    try {\n      if (!isCancelled) {\n        // axios.defaults.baseURL = 'https://api.spotify.com/v1'\n        const {\n          data\n        } = await getUserTopTracks();\n        const key = 0;\n        setTopSongs(data.items);\n        const albumCover = data.items[key].album.images[0].url;\n        setAlbumCover(albumCover);\n        const myTrack = data.items[key].name;\n        setTopTrack(myTrack);\n        const myArtist = data.items[key].artists[0].name;\n        setArtist(myArtist);\n        const preview = data.items[key].preview_url;\n        setPreviewUrl(preview);\n        setTopTrack({\n          song: myTrack,\n          artist: myArtist,\n          albumCover: albumCover,\n          preview: preview\n        });\n      }\n    } catch (e) {\n      if (!isCancelled) {\n        console.error(e);\n      }\n    }\n\n    try {\n      if (!isCancelled) {\n        // axios.defaults.baseURL = 'https://api.spotify.com/v1'            \n        const {\n          data\n        } = await getUserTopArtists();\n        setArtist(data.items[0].name);\n        setGenre([data.items[0].genres[0], data.items[0].genres[1]]);\n        setArtistImage(data.items[0].images[0].url);\n        setArtistId(data.items[0].id);\n      }\n    } catch (e) {\n      if (!isCancelled) {\n        console.error(e);\n      }\n    }\n  };\n\n  useEffect(() => {\n    setToken(accessToken);\n    setJustLoggedIn(true);\n    let isCancelled = false;\n\n    if (!isCancelled) {\n      catchErrors(fetchData());\n    }\n\n    return () => {\n      isCancelled = true;\n    };\n  }, []);\n  useEffect(() => {\n    let isCancelled = false;\n\n    const postData = async () => {\n      try {\n        if (!isCancelled) {\n          findUser.post('/', {\n            name: firstName,\n            email: email,\n            country: country,\n            photo: profilePhoto,\n            topTrack: topTrack,\n            artist: artist,\n            artistImage: artistImage,\n            genre: genre\n          });\n        }\n      } catch (error) {\n        if (!isCancelled) {\n          console.log(error);\n        }\n      }\n    };\n\n    postData();\n    return () => {\n      isCancelled = true;\n    };\n  }, []);\n  const user = {\n    token: token,\n    firstName: firstName,\n    profilePhoto: profilePhoto,\n    country: country,\n    topSongs: topSongs,\n    topTrack: topTrack,\n    artist: artist,\n    artistImage: artistImage,\n    artistId,\n    genre: genre,\n    preview: previewUrl,\n    albumCover: albumCover,\n    isPlaying: isPlaying,\n    similarArtists: similarArtists,\n    points: points\n  };\n\n  function ErrorHandler(_ref) {\n    let {\n      error\n    } = _ref;\n    return /*#__PURE__*/_jsxDEV(\"div\", {\n      role: \"alert\",\n      children: [/*#__PURE__*/_jsxDEV(\"p\", {\n        children: \"An error occured\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 211,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"pre\", {\n        children: error.message\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 212,\n        columnNumber: 9\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 210,\n      columnNumber: 7\n    }, this);\n  }\n\n  return !token ? /*#__PURE__*/_jsxDEV(LandingPage, {}, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 220,\n    columnNumber: 7\n  }, this) : /*#__PURE__*/_jsxDEV(Router, {\n    children: /*#__PURE__*/_jsxDEV(ErrorBoundary, {\n      FallbackComponent: ErrorHandler,\n      children: /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"wrapper\",\n        children: /*#__PURE__*/_jsxDEV(UserContext.Provider, {\n          value: user && user,\n          children: [/*#__PURE__*/_jsxDEV(\"div\", {\n            children: /*#__PURE__*/_jsxDEV(Header, {}, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 227,\n              columnNumber: 11\n            }, this)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 226,\n            columnNumber: 9\n          }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"main\",\n            children: /*#__PURE__*/_jsxDEV(Main, {}, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 232,\n              columnNumber: 11\n            }, this)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 230,\n            columnNumber: 9\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 225,\n          columnNumber: 5\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 224,\n        columnNumber: 5\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 223,\n      columnNumber: 7\n    }, this)\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 222,\n    columnNumber: 5\n  }, this);\n}\n\n_s(App, \"VaO5lEzaiJq1lUvsSDsWtPtEKLY=\");\n\n_c = App;\n\nvar _c;\n\n$RefreshReg$(_c, \"App\");","map":{"version":3,"sources":["C:/Users/Mike/my-app/client/src/App.js"],"names":["React","Header","Main","useEffect","useState","useContext","useRef","UserContext","axios","accessToken","getCurrentUserProfile","getUserTopTracks","getUserTopArtists","catchErrors","BrowserRouter","Router","LandingPage","ErrorBoundary","findUser","App","firstName","setFirstName","profilePhoto","setProfilePhoto","country","setCountry","topTrack","setTopTrack","artist","setArtist","artistImage","setArtistImage","artistId","setArtistId","genre","setGenre","previewUrl","setPreviewUrl","albumCover","setAlbumCover","isPlaying","setIsPlaying","topSongs","setTopSongs","song","preview","similarArtists","setSimilarArtists","points","setPoints","currentlyPlaying","setCurrentlyPlaying","email","setEmail","token","setToken","justLoggedIn","setJustLoggedIn","componentIsMounted","window","history","pushState","fetchData","isCancelled","data","fullName","display_name","nameArray","split","profPic","images","url","location","e","console","error","key","items","album","myTrack","name","myArtist","artists","preview_url","genres","id","postData","post","photo","log","user","ErrorHandler","message"],"mappings":"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","sourcesContent":["import React from \"react\"\nimport Header from \"./components/Header\"\nimport Main from \"./components/Main\"\nimport { useEffect, useState, useContext, useRef } from \"react\"\nimport { UserContext } from \"./UserContext\"\nimport axios from \"axios\"\nimport { accessToken, getCurrentUserProfile, getUserTopTracks, getUserTopArtists } from \"./spotify\"\nimport { catchErrors } from \"./utils\"\nimport { BrowserRouter as Router} from \"react-router-dom\"\nimport LandingPage from \"./components/pages/LandingPage\"\nimport { ErrorBoundary } from \"react-error-boundary\"\nimport findUser from \"./axios-api\"\n\nexport default function App(){\n  const [firstName, setFirstName] = useState(\"\")\n  const [profilePhoto, setProfilePhoto] = useState(\"\")\n  const [country, setCountry] = useState(\"\")\n  const [topTrack, setTopTrack] = useState(\"\")\n  const [artist, setArtist] = useState(\"\")\n  const [artistImage, setArtistImage] = useState(\"\")\n  const [artistId, setArtistId] = useState(\"\")\n  const [genre, setGenre] = useState([])\n  const [previewUrl, setPreviewUrl] = useState(\"\")\n  const [albumCover, setAlbumCover] = useState(\"\")\n  const [isPlaying, setIsPlaying] = React.useState(false)\n  const [topSongs, setTopSongs] = useState([{\n    song: \"\",\n    artist: \"\",\n    albumCover: \"\",\n    preview: \"\"\n  }])\n\n  const [similarArtists, setSimilarArtists] = useState(null)\n  const [points, setPoints] = useState(2)\n  const [currentlyPlaying, setCurrentlyPlaying] = useState(null)\n  const [email, setEmail] = useState(null)\n  const [token, setToken] = useState(\"\")\n  const [justLoggedIn, setJustLoggedIn] = useState(false)\n\n\n  const componentIsMounted = useRef(true)\n\n  // const navigate = useNavigate()\n\n  // useEffect(() => {\n  //   return() => {\n  //     componentIsMounted.current = false\n  //   }\n  // })\n\n  useEffect(()=>{\n    window.history.pushState({}, null, \"/\")\n\n\n  },[token])\n  \n  const fetchData = async () => {\n    try {\n      if(!isCancelled){\n        // axios.defaults.baseURL = 'https://api.spotify.com/v1'\n        const { data } = await getCurrentUserProfile()\n        const fullName = data.display_name\n        const nameArray = fullName.split(' ')\n        const firstName = nameArray[0]\n        setFirstName(firstName)\n        const profPic = data.images[0].url\n        setProfilePhoto(profPic)\n        const location = data.country\n        setCountry(location)\n        setEmail(data.email)\n      }\n      \n    } catch(e) {\n      if(!isCancelled){\n        console.error(e);\n      }\n    }\n    \n\n    try {\n      if(!isCancelled){\n          // axios.defaults.baseURL = 'https://api.spotify.com/v1'\n          const {data} = await getUserTopTracks()\n          const key = 0\n            setTopSongs(data.items)\n            const albumCover = data.items[key].album.images[0].url\n            setAlbumCover(albumCover)\n            const myTrack = data.items[key].name\n            setTopTrack(myTrack)\n            const myArtist = data.items[key].artists[0].name\n            setArtist(myArtist)\n            const preview = data.items[key].preview_url\n            setPreviewUrl(preview)\n            setTopTrack(\n              {\n              song: myTrack,\n              artist: myArtist,\n              albumCover: albumCover,\n              preview: preview\n            })      \n          }\n        }\n    catch(e) {\n      if(!isCancelled){\n        console.error(e)\n      }\n    }\n\n    try {\n      if(!isCancelled){\n          // axios.defaults.baseURL = 'https://api.spotify.com/v1'            \n          const {data} = await getUserTopArtists()\n          setArtist(data.items[0].name)\n          setGenre([data.items[0].genres[0], data.items[0].genres[1]])\n          setArtistImage(data.items[0].images[0].url)\n          setArtistId(data.items[0].id)\n\n        }\n      }\n    catch(e) {\n      if(!isCancelled){\n        console.error(e)\n      }\n    }\n\n  }\n\n\n  useEffect(() => {\n    setToken(accessToken)\n    setJustLoggedIn(true)\n\n    let isCancelled = false\n\n\n\n    if(!isCancelled){\n      catchErrors(fetchData()) \n    }   \n\n    return () => {\n      isCancelled = true\n    }\n\n  }, []);\n\n \n  useEffect(() => {\n\n    let isCancelled = false\n\n    const postData = async() => {\n      try{ \n        if(!isCancelled){\n          findUser.post('/', {\n          name: firstName,\n          email: email,\n          country: country,\n          photo: profilePhoto,\n          topTrack: topTrack,\n          artist: artist,\n          artistImage: artistImage,\n          genre: genre\n        })\n\n      }\n    } catch(error){\n\n      if(!isCancelled){\n        console.log(error)\n\n      }\n\n    }\n    }\n\n    postData()\n\n  return () => {\n    isCancelled = true\n  }\n\n\n\n  }, [])\n\n\n\n  const user = {\n    token: token,\n    firstName: firstName,\n    profilePhoto: profilePhoto,\n    country: country,\n    topSongs: topSongs,\n    topTrack: topTrack,\n    artist: artist,\n    artistImage: artistImage,\n    artistId,\n    genre: genre,\n    preview: previewUrl,\n    albumCover: albumCover,\n    isPlaying: isPlaying,\n    similarArtists: similarArtists,\n    points: points\n  }\n\n\n  function ErrorHandler({error}){\n    return(\n      <div role=\"alert\">\n        <p>An error occured</p>\n        <pre>{error.message}</pre>\n      </div>\n    )\n  }\n\n\n  return(\n    !token ? \n      <LandingPage />\n      :\n    <Router>\n      <ErrorBoundary FallbackComponent={ErrorHandler}>\n    <div className=\"wrapper\">\n    <UserContext.Provider value={user && user}>\n        <div>\n          <Header \n          />\n        </div>\n        <div className=\"main\">\n          \n          <Main \n            />\n        </div>\n    </UserContext.Provider>\n\n      </div>\n      </ErrorBoundary>\n    </Router>\n\n  )\n}"]},"metadata":{},"sourceType":"module"}