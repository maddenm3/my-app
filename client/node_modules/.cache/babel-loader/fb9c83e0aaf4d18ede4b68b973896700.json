{"ast":null,"code":"import _asyncToGenerator from\"C:\\\\Users\\\\Mike\\\\my-app\\\\client\\\\node_modules\\\\@babel\\\\runtime\\\\helpers\\\\esm\\\\asyncToGenerator.js\";import _slicedToArray from\"C:\\\\Users\\\\Mike\\\\my-app\\\\client\\\\node_modules\\\\@babel\\\\runtime\\\\helpers\\\\esm\\\\slicedToArray.js\";import _regeneratorRuntime from\"C:\\\\Users\\\\Mike\\\\my-app\\\\client\\\\node_modules\\\\@babel\\\\runtime\\\\regenerator\\\\index.js\";import React from\"react\";import Header from\"./components/Header\";import Main from\"./components/Main\";import{useEffect,useState,useContext,useRef}from\"react\";import{UserContext}from\"./UserContext\";import axios from\"axios\";import{accessToken,getCurrentUserProfile,getUserTopTracks,getUserTopArtists,getListeningNow}from\"./spotify\";import{catchErrors}from\"./utils\";import{BrowserRouter as Router}from\"react-router-dom\";import LandingPage from\"./components/pages/LandingPage\";import{ErrorBoundary}from\"react-error-boundary\";import findUser from\"./axios-api\";import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";export default function App(){var _useState=useState(\"\"),_useState2=_slicedToArray(_useState,2),firstName=_useState2[0],setFirstName=_useState2[1];var _useState3=useState(\"\"),_useState4=_slicedToArray(_useState3,2),profilePhoto=_useState4[0],setProfilePhoto=_useState4[1];var _useState5=useState(\"\"),_useState6=_slicedToArray(_useState5,2),country=_useState6[0],setCountry=_useState6[1];var _useState7=useState(\"\"),_useState8=_slicedToArray(_useState7,2),topTrack=_useState8[0],setTopTrack=_useState8[1];var _useState9=useState(\"\"),_useState10=_slicedToArray(_useState9,2),artist=_useState10[0],setArtist=_useState10[1];var _useState11=useState(\"\"),_useState12=_slicedToArray(_useState11,2),artistImage=_useState12[0],setArtistImage=_useState12[1];var _useState13=useState(\"\"),_useState14=_slicedToArray(_useState13,2),artistId=_useState14[0],setArtistId=_useState14[1];var _useState15=useState([]),_useState16=_slicedToArray(_useState15,2),genre=_useState16[0],setGenre=_useState16[1];var _useState17=useState(\"\"),_useState18=_slicedToArray(_useState17,2),previewUrl=_useState18[0],setPreviewUrl=_useState18[1];var _useState19=useState(\"\"),_useState20=_slicedToArray(_useState19,2),albumCover=_useState20[0],setAlbumCover=_useState20[1];var _React$useState=React.useState(false),_React$useState2=_slicedToArray(_React$useState,2),isPlaying=_React$useState2[0],setIsPlaying=_React$useState2[1];var _useState21=useState([{song:\"\",artist:\"\",albumCover:\"\",preview:\"\"}]),_useState22=_slicedToArray(_useState21,2),topSongs=_useState22[0],setTopSongs=_useState22[1];var _useState23=useState(null),_useState24=_slicedToArray(_useState23,2),similarArtists=_useState24[0],setSimilarArtists=_useState24[1];var _useState25=useState(2),_useState26=_slicedToArray(_useState25,2),points=_useState26[0],setPoints=_useState26[1];var _useState27=useState(null),_useState28=_slicedToArray(_useState27,2),currentlyPlaying=_useState28[0],setCurrentlyPlaying=_useState28[1];var _useState29=useState(null),_useState30=_slicedToArray(_useState29,2),email=_useState30[0],setEmail=_useState30[1];var _useState31=useState(\"\"),_useState32=_slicedToArray(_useState31,2),token=_useState32[0],setToken=_useState32[1];var _useState33=useState(false),_useState34=_slicedToArray(_useState33,2),justLoggedIn=_useState34[0],setJustLoggedIn=_useState34[1];var componentIsMounted=useRef(true);useEffect(function(){window.history.pushState({},null,\"/\");},[token]);var fetchData=/*#__PURE__*/function(){var _ref=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(){var _yield$getCurrentUser,data,fullName,nameArray,_firstName,profPic,location,_yield$getUserTopTrac,_data,key,_albumCover,myTrack,myArtist,preview,_yield$getUserTopArti,_data2,_yield$getListeningNo,_data3;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:_context.prev=0;_context.next=3;return getCurrentUserProfile();case 3:_yield$getCurrentUser=_context.sent;data=_yield$getCurrentUser.data;fullName=data.display_name;nameArray=fullName.split(' ');_firstName=nameArray[0];setFirstName(_firstName);profPic=data.images[0].url;setProfilePhoto(profPic);location=data.country;setCountry(location);setEmail(data.email);_context.next=19;break;case 16:_context.prev=16;_context.t0=_context[\"catch\"](0);console.error(_context.t0);case 19:_context.prev=19;_context.next=22;return getUserTopTracks();case 22:_yield$getUserTopTrac=_context.sent;_data=_yield$getUserTopTrac.data;key=0;setTopSongs(_data.items);_albumCover=_data.items[key].album.images[0].url;setAlbumCover(_albumCover);myTrack=_data.items[key].name;setTopTrack(myTrack);myArtist=_data.items[key].artists[0].name;setArtist(myArtist);preview=_data.items[key].preview_url;setPreviewUrl(preview);setTopTrack({song:myTrack,artist:myArtist,albumCover:_albumCover,preview:preview});_context.next=40;break;case 37:_context.prev=37;_context.t1=_context[\"catch\"](19);console.error(_context.t1);case 40:_context.prev=40;_context.next=43;return getUserTopArtists();case 43:_yield$getUserTopArti=_context.sent;_data2=_yield$getUserTopArti.data;setArtist(_data2.items[0].name);setGenre([_data2.items[0].genres[0],_data2.items[0].genres[1]]);setArtistImage(_data2.items[0].images[0].url);setArtistId(_data2.items[0].id);_context.next=54;break;case 51:_context.prev=51;_context.t2=_context[\"catch\"](40);console.error(_context.t2);case 54:_context.prev=54;_context.next=57;return getListeningNow();case 57:_yield$getListeningNo=_context.sent;_data3=_yield$getListeningNo.data;setCurrentlyPlaying(_data3.item);_context.next=65;break;case 62:_context.prev=62;_context.t3=_context[\"catch\"](54);console.error(_context.t3);case 65:case\"end\":return _context.stop();}}},_callee,null,[[0,16],[19,37],[40,51],[54,62]]);}));return function fetchData(){return _ref.apply(this,arguments);};}();useEffect(function(){setToken(accessToken);setJustLoggedIn(true);var isCancelled=false;if(!isCancelled){if(accessToken){catchErrors(fetchData());}}return function(){isCancelled=true;};},[]);useEffect(function(){var isCancelled=false;var postData=/*#__PURE__*/function(){var _ref2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee2(){return _regeneratorRuntime.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:try{if(!isCancelled){findUser.post('/',{name:firstName,email:email,country:country,photo:profilePhoto,topTrack:topTrack,artist:artist,artistImage:artistImage,genre:genre});}}catch(error){if(!isCancelled){console.log(error);}}case 1:case\"end\":return _context2.stop();}}},_callee2);}));return function postData(){return _ref2.apply(this,arguments);};}();postData();return function(){isCancelled=true;};},[]);var user={token:token,firstName:firstName,profilePhoto:profilePhoto,country:country,topSongs:topSongs,topTrack:topTrack,artist:artist,artistImage:artistImage,artistId:artistId,currentlyPlaying:currentlyPlaying,genre:genre,preview:previewUrl,albumCover:albumCover,isPlaying:isPlaying,similarArtists:similarArtists,points:points};function ErrorHandler(_ref3){var error=_ref3.error;return/*#__PURE__*/_jsxs(\"div\",{role:\"alert\",children:[/*#__PURE__*/_jsx(\"p\",{children:\"An error occured\"}),/*#__PURE__*/_jsx(\"pre\",{children:error.message})]});}return!token?/*#__PURE__*/_jsx(LandingPage,{}):/*#__PURE__*/_jsx(Router,{children:/*#__PURE__*/_jsx(ErrorBoundary,{FallbackComponent:ErrorHandler,children:/*#__PURE__*/_jsx(\"div\",{className:\"wrapper\",children:/*#__PURE__*/_jsxs(UserContext.Provider,{value:user&&user,children:[/*#__PURE__*/_jsx(\"div\",{children:/*#__PURE__*/_jsx(Header,{})}),/*#__PURE__*/_jsx(\"div\",{className:\"main\",children:/*#__PURE__*/_jsx(Main,{})})]})})})});}","map":{"version":3,"sources":["C:/Users/Mike/my-app/client/src/App.js"],"names":["React","Header","Main","useEffect","useState","useContext","useRef","UserContext","axios","accessToken","getCurrentUserProfile","getUserTopTracks","getUserTopArtists","getListeningNow","catchErrors","BrowserRouter","Router","LandingPage","ErrorBoundary","findUser","App","firstName","setFirstName","profilePhoto","setProfilePhoto","country","setCountry","topTrack","setTopTrack","artist","setArtist","artistImage","setArtistImage","artistId","setArtistId","genre","setGenre","previewUrl","setPreviewUrl","albumCover","setAlbumCover","isPlaying","setIsPlaying","song","preview","topSongs","setTopSongs","similarArtists","setSimilarArtists","points","setPoints","currentlyPlaying","setCurrentlyPlaying","email","setEmail","token","setToken","justLoggedIn","setJustLoggedIn","componentIsMounted","window","history","pushState","fetchData","data","fullName","display_name","nameArray","split","profPic","images","url","location","console","error","key","items","album","myTrack","name","myArtist","artists","preview_url","genres","id","item","isCancelled","postData","post","photo","log","user","ErrorHandler","message"],"mappings":"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","sourcesContent":["import React from \"react\"\nimport Header from \"./components/Header\"\nimport Main from \"./components/Main\"\nimport { useEffect, useState, useContext, useRef } from \"react\"\nimport { UserContext } from \"./UserContext\"\nimport axios from \"axios\"\nimport { accessToken, getCurrentUserProfile, getUserTopTracks, getUserTopArtists, getListeningNow } from \"./spotify\"\nimport { catchErrors } from \"./utils\"\nimport { BrowserRouter as Router} from \"react-router-dom\"\nimport LandingPage from \"./components/pages/LandingPage\"\nimport { ErrorBoundary } from \"react-error-boundary\"\nimport findUser from \"./axios-api\"\n\nexport default function App(){\n  const [firstName, setFirstName] = useState(\"\")\n  const [profilePhoto, setProfilePhoto] = useState(\"\")\n  const [country, setCountry] = useState(\"\")\n  const [topTrack, setTopTrack] = useState(\"\")\n  const [artist, setArtist] = useState(\"\")\n  const [artistImage, setArtistImage] = useState(\"\")\n  const [artistId, setArtistId] = useState(\"\")\n  const [genre, setGenre] = useState([])\n  const [previewUrl, setPreviewUrl] = useState(\"\")\n  const [albumCover, setAlbumCover] = useState(\"\")\n  const [isPlaying, setIsPlaying] = React.useState(false)\n  const [topSongs, setTopSongs] = useState([{\n    song: \"\",\n    artist: \"\",\n    albumCover: \"\",\n    preview: \"\"\n  }])\n\n  const [similarArtists, setSimilarArtists] = useState(null)\n  const [points, setPoints] = useState(2)\n  const [currentlyPlaying, setCurrentlyPlaying] = useState(null)\n  const [email, setEmail] = useState(null)\n  const [token, setToken] = useState(\"\")\n  const [justLoggedIn, setJustLoggedIn] = useState(false)\n  const componentIsMounted = useRef(true)\n\n\n  useEffect(()=>{\n    window.history.pushState({}, null, \"/\")\n\n\n  },[token])\n  \n  const fetchData = async () => {\n    try {\n        const { data } = await getCurrentUserProfile()\n        const fullName = data.display_name\n        const nameArray = fullName.split(' ')\n        const firstName = nameArray[0]\n        setFirstName(firstName)\n        const profPic = data.images[0].url\n        setProfilePhoto(profPic)\n        const location = data.country\n        setCountry(location)\n        setEmail(data.email)\n      \n      \n    } catch(e) {\n        console.error(e);\n      \n    }\n    \n\n    try {\n          // axios.defaults.baseURL = 'https://api.spotify.com/v1'\n          const {data} = await getUserTopTracks()\n          const key = 0\n            setTopSongs(data.items)\n            const albumCover = data.items[key].album.images[0].url\n            setAlbumCover(albumCover)\n            const myTrack = data.items[key].name\n            setTopTrack(myTrack)\n            const myArtist = data.items[key].artists[0].name\n            setArtist(myArtist)\n            const preview = data.items[key].preview_url\n            setPreviewUrl(preview)\n            setTopTrack(\n              {\n              song: myTrack,\n              artist: myArtist,\n              albumCover: albumCover,\n              preview: preview\n            })      \n          \n        }\n    catch(e) {\n        console.error(e)\n      \n    }\n\n    try {\n          // axios.defaults.baseURL = 'https://api.spotify.com/v1'            \n          const {data} = await getUserTopArtists()\n          setArtist(data.items[0].name)\n          setGenre([data.items[0].genres[0], data.items[0].genres[1]])\n          setArtistImage(data.items[0].images[0].url)\n          setArtistId(data.items[0].id)\n\n        \n      }\n    catch(e) {\n        console.error(e)\n      \n    }\n\n    try {\n      const {data} = await getListeningNow()\n      setCurrentlyPlaying(data.item)\n\n    \n  }\ncatch(e) {\n    console.error(e)\n  \n}\n\n  }\n\n\n  useEffect(() => {\n    setToken(accessToken)\n    setJustLoggedIn(true)\n\n    let isCancelled = false\n\n\n\n    if(!isCancelled){\n      if(accessToken){\n        catchErrors(fetchData()) \n      }\n    }   \n\n    return () => {\n      isCancelled = true\n    }\n\n  }, []);\n\n \n  useEffect(() => {\n\n    let isCancelled = false\n\n    const postData = async() => {\n      try{ \n        if(!isCancelled){\n          findUser.post('/', {\n          name: firstName,\n          email: email,\n          country: country,\n          photo: profilePhoto,\n          topTrack: topTrack,\n          artist: artist,\n          artistImage: artistImage,\n          genre: genre\n        })\n\n      }\n    } catch(error){\n\n      if(!isCancelled){\n        console.log(error)\n\n      }\n\n    }\n    }\n\n    postData()\n\n  return () => {\n    isCancelled = true\n  }\n\n\n\n  }, [])\n\n\n\n  const user = {\n    token: token,\n    firstName: firstName,\n    profilePhoto: profilePhoto,\n    country: country,\n    topSongs: topSongs,\n    topTrack: topTrack,\n    artist: artist,\n    artistImage: artistImage,\n    artistId,\n    currentlyPlaying: currentlyPlaying,\n    genre: genre,\n    preview: previewUrl,\n    albumCover: albumCover,\n    isPlaying: isPlaying,\n    similarArtists: similarArtists,\n    points: points\n  }\n\n\n  function ErrorHandler({error}){\n    return(\n      <div role=\"alert\">\n        <p>An error occured</p>\n        <pre>{error.message}</pre>\n      </div>\n    )\n  }\n\n\n  return(\n    !token ? \n      <LandingPage />\n      :\n    <Router>\n      <ErrorBoundary FallbackComponent={ErrorHandler}>\n    <div className=\"wrapper\">\n    <UserContext.Provider value={user && user}>\n        <div>\n          <Header \n          />\n        </div>\n        <div className=\"main\">\n          \n          <Main \n            />\n        </div>\n    </UserContext.Provider>\n\n      </div>\n      </ErrorBoundary>\n    </Router>\n\n  )\n}"]},"metadata":{},"sourceType":"module"}