{"ast":null,"code":"import _asyncToGenerator from\"C:\\\\Users\\\\Mike\\\\my-app\\\\client\\\\node_modules\\\\@babel\\\\runtime\\\\helpers\\\\esm\\\\asyncToGenerator.js\";import _slicedToArray from\"C:\\\\Users\\\\Mike\\\\my-app\\\\client\\\\node_modules\\\\@babel\\\\runtime\\\\helpers\\\\esm\\\\slicedToArray.js\";import _regeneratorRuntime from\"C:\\\\Users\\\\Mike\\\\my-app\\\\client\\\\node_modules\\\\@babel\\\\runtime\\\\regenerator\\\\index.js\";import React from\"react\";import Header from\"./components/Header\";import Main from\"./components/Main\";import{useEffect,useState,useContext,useRef}from\"react\";import{UserContext}from\"./UserContext\";import axios from\"axios\";import{accessToken,getCurrentUserProfile,getUserTopTracks,getUserTopArtists}from\"./spotify\";import{catchErrors}from\"./utils\";import{BrowserRouter as Router}from\"react-router-dom\";import LandingPage from\"./components/pages/LandingPage\";import{ErrorBoundary}from\"react-error-boundary\";import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";export default function App(){var _useState=useState(\"\"),_useState2=_slicedToArray(_useState,2),firstName=_useState2[0],setFirstName=_useState2[1];var _useState3=useState(\"\"),_useState4=_slicedToArray(_useState3,2),profilePhoto=_useState4[0],setProfilePhoto=_useState4[1];var _useState5=useState(\"\"),_useState6=_slicedToArray(_useState5,2),country=_useState6[0],setCountry=_useState6[1];var _useState7=useState(\"\"),_useState8=_slicedToArray(_useState7,2),topTrack=_useState8[0],setTopTrack=_useState8[1];var _useState9=useState(\"\"),_useState10=_slicedToArray(_useState9,2),artist=_useState10[0],setArtist=_useState10[1];var _useState11=useState(\"\"),_useState12=_slicedToArray(_useState11,2),artistImage=_useState12[0],setArtistImage=_useState12[1];var _useState13=useState(\"\"),_useState14=_slicedToArray(_useState13,2),artistId=_useState14[0],setArtistId=_useState14[1];var _useState15=useState([]),_useState16=_slicedToArray(_useState15,2),genre=_useState16[0],setGenre=_useState16[1];var _useState17=useState(\"\"),_useState18=_slicedToArray(_useState17,2),previewUrl=_useState18[0],setPreviewUrl=_useState18[1];var _useState19=useState(\"\"),_useState20=_slicedToArray(_useState19,2),albumCover=_useState20[0],setAlbumCover=_useState20[1];var _React$useState=React.useState(false),_React$useState2=_slicedToArray(_React$useState,2),isPlaying=_React$useState2[0],setIsPlaying=_React$useState2[1];var _useState21=useState([{song:\"\",artist:\"\",albumCover:\"\",preview:\"\"}]),_useState22=_slicedToArray(_useState21,2),topSongs=_useState22[0],setTopSongs=_useState22[1];var _useState23=useState(null),_useState24=_slicedToArray(_useState23,2),similarArtists=_useState24[0],setSimilarArtists=_useState24[1];var _useState25=useState(2),_useState26=_slicedToArray(_useState25,2),points=_useState26[0],setPoints=_useState26[1];var _useState27=useState(null),_useState28=_slicedToArray(_useState27,2),currentlyPlaying=_useState28[0],setCurrentlyPlaying=_useState28[1];var _useState29=useState(null),_useState30=_slicedToArray(_useState29,2),email=_useState30[0],setEmail=_useState30[1];var _useState31=useState(\"\"),_useState32=_slicedToArray(_useState31,2),token=_useState32[0],setToken=_useState32[1];var _useState33=useState(false),_useState34=_slicedToArray(_useState33,2),justLoggedIn=_useState34[0],setJustLoggedIn=_useState34[1];var componentIsMounted=useRef(true);// const navigate = useNavigate()\n// useEffect(() => {\n//   return() => {\n//     componentIsMounted.current = false\n//   }\n// })\nuseEffect(function(){window.history.pushState({},null,\"/\");},[token]);useEffect(function(){setToken(accessToken);setJustLoggedIn(true);var isCancelled=false;var fetchData=/*#__PURE__*/function(){var _ref=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(){var _yield$getCurrentUser,data,fullName,nameArray,_firstName,profPic,location,userEmail,_yield$getUserTopTrac,_data,key,_albumCover,myTrack,myArtist,preview,_yield$getUserTopArti,_data2;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:_context.prev=0;if(isCancelled){_context.next=17;break;}axios.defaults.baseURL='https://api.spotify.com/v1';_context.next=5;return getCurrentUserProfile();case 5:_yield$getCurrentUser=_context.sent;data=_yield$getCurrentUser.data;fullName=data.display_name;nameArray=fullName.split(' ');_firstName=nameArray[0];setFirstName(_firstName);profPic=data.images[0].url;setProfilePhoto(profPic);location=data.country;setCountry(location);userEmail=data.email;setEmail(data.email);case 17:_context.next=22;break;case 19:_context.prev=19;_context.t0=_context[\"catch\"](0);if(!isCancelled){console.error(_context.t0);}case 22:_context.prev=22;if(isCancelled){_context.next=40;break;}axios.defaults.baseURL='https://api.spotify.com/v1';_context.next=27;return getUserTopTracks();case 27:_yield$getUserTopTrac=_context.sent;_data=_yield$getUserTopTrac.data;key=0;setTopSongs(_data.items);_albumCover=_data.items[key].album.images[0].url;setAlbumCover(_albumCover);myTrack=_data.items[key].name;setTopTrack(myTrack);myArtist=_data.items[key].artists[0].name;setArtist(myArtist);preview=_data.items[key].preview_url;setPreviewUrl(preview);setTopTrack({song:myTrack,artist:myArtist,albumCover:_albumCover,preview:preview});case 40:_context.next=45;break;case 42:_context.prev=42;_context.t1=_context[\"catch\"](22);if(!isCancelled){console.error(_context.t1);}case 45:_context.prev=45;if(isCancelled){_context.next=56;break;}axios.defaults.baseURL='https://api.spotify.com/v1';_context.next=50;return getUserTopArtists();case 50:_yield$getUserTopArti=_context.sent;_data2=_yield$getUserTopArti.data;setArtist(_data2.items[0].name);setGenre([_data2.items[0].genres[0],_data2.items[0].genres[1]]);setArtistImage(_data2.items[0].images[0].url);setArtistId(_data2.items[0].id);case 56:_context.next=61;break;case 58:_context.prev=58;_context.t2=_context[\"catch\"](45);if(!isCancelled){console.error(_context.t2);}case 61:case\"end\":return _context.stop();}}},_callee,null,[[0,19],[22,42],[45,58]]);}));return function fetchData(){return _ref.apply(this,arguments);};}();catchErrors(fetchData());return function(){isCancelled=true;};},[]);useEffect(function(){var isCancelled=false;var postData=/*#__PURE__*/function(){var _ref2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee2(){return _regeneratorRuntime.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:try{if(!isCancelled){axios.defaults.baseURL=process.env.REACT_APP_URL;axios.post('/users',{name:firstName,email:email,country:country,photo:profilePhoto,topTrack:topTrack,artist:artist,artistImage:artistImage,genre:genre});console.log(\"posted idk\");}}catch(error){if(!isCancelled){console.log(error);console.log(\"not posted\");}}case 1:case\"end\":return _context2.stop();}}},_callee2);}));return function postData(){return _ref2.apply(this,arguments);};}();postData();return function(){isCancelled=true;};},[]);var logout=function logout(){setToken(\"\");window.localStorage.removeItem(\"token\");};var user={token:token,firstName:firstName,profilePhoto:profilePhoto,country:country,topSongs:topSongs,topTrack:topTrack,artist:artist,artistImage:artistImage,artistId:artistId,genre:genre,preview:previewUrl,albumCover:albumCover,isPlaying:isPlaying,similarArtists:similarArtists,points:points};function ErrorHandler(_ref3){var error=_ref3.error;return/*#__PURE__*/_jsxs(\"div\",{role:\"alert\",children:[/*#__PURE__*/_jsx(\"p\",{children:\"An error occured\"}),/*#__PURE__*/_jsx(\"pre\",{children:error.message})]});}return!token?/*#__PURE__*/_jsx(LandingPage,{}):/*#__PURE__*/_jsx(Router,{children:/*#__PURE__*/_jsx(ErrorBoundary,{FallbackComponent:ErrorHandler,children:/*#__PURE__*/_jsx(\"div\",{className:\"wrapper\",children:/*#__PURE__*/_jsxs(UserContext.Provider,{value:user&&user,children:[/*#__PURE__*/_jsx(\"div\",{children:/*#__PURE__*/_jsx(Header,{})}),/*#__PURE__*/_jsx(\"div\",{className:\"main\",children:/*#__PURE__*/_jsx(Main,{})})]})})})});}","map":{"version":3,"sources":["C:/Users/Mike/my-app/client/src/App.js"],"names":["React","Header","Main","useEffect","useState","useContext","useRef","UserContext","axios","accessToken","getCurrentUserProfile","getUserTopTracks","getUserTopArtists","catchErrors","BrowserRouter","Router","LandingPage","ErrorBoundary","App","firstName","setFirstName","profilePhoto","setProfilePhoto","country","setCountry","topTrack","setTopTrack","artist","setArtist","artistImage","setArtistImage","artistId","setArtistId","genre","setGenre","previewUrl","setPreviewUrl","albumCover","setAlbumCover","isPlaying","setIsPlaying","song","preview","topSongs","setTopSongs","similarArtists","setSimilarArtists","points","setPoints","currentlyPlaying","setCurrentlyPlaying","email","setEmail","token","setToken","justLoggedIn","setJustLoggedIn","componentIsMounted","window","history","pushState","isCancelled","fetchData","defaults","baseURL","data","fullName","display_name","nameArray","split","profPic","images","url","location","userEmail","console","error","key","items","album","myTrack","name","myArtist","artists","preview_url","genres","id","postData","process","env","REACT_APP_URL","post","photo","log","logout","localStorage","removeItem","user","ErrorHandler","message"],"mappings":"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","sourcesContent":["import React from \"react\"\nimport Header from \"./components/Header\"\nimport Main from \"./components/Main\"\nimport { useEffect, useState, useContext, useRef } from \"react\"\nimport { UserContext } from \"./UserContext\"\nimport axios from \"axios\"\nimport { accessToken, getCurrentUserProfile, getUserTopTracks, getUserTopArtists } from \"./spotify\"\nimport { catchErrors } from \"./utils\"\nimport { BrowserRouter as Router} from \"react-router-dom\"\nimport LandingPage from \"./components/pages/LandingPage\"\nimport { ErrorBoundary } from \"react-error-boundary\"\n\nexport default function App(){\n  const [firstName, setFirstName] = useState(\"\")\n  const [profilePhoto, setProfilePhoto] = useState(\"\")\n  const [country, setCountry] = useState(\"\")\n  const [topTrack, setTopTrack] = useState(\"\")\n  const [artist, setArtist] = useState(\"\")\n  const [artistImage, setArtistImage] = useState(\"\")\n  const [artistId, setArtistId] = useState(\"\")\n  const [genre, setGenre] = useState([])\n  const [previewUrl, setPreviewUrl] = useState(\"\")\n  const [albumCover, setAlbumCover] = useState(\"\")\n  const [isPlaying, setIsPlaying] = React.useState(false)\n  const [topSongs, setTopSongs] = useState([{\n    song: \"\",\n    artist: \"\",\n    albumCover: \"\",\n    preview: \"\"\n  }])\n\n  const [similarArtists, setSimilarArtists] = useState(null)\n  const [points, setPoints] = useState(2)\n  const [currentlyPlaying, setCurrentlyPlaying] = useState(null)\n  const [email, setEmail] = useState(null)\n  const [token, setToken] = useState(\"\")\n  const [justLoggedIn, setJustLoggedIn] = useState(false)\n\n\n  const componentIsMounted = useRef(true)\n\n  // const navigate = useNavigate()\n\n  // useEffect(() => {\n  //   return() => {\n  //     componentIsMounted.current = false\n  //   }\n  // })\n\n  useEffect(()=>{\n    window.history.pushState({}, null, \"/\")\n\n\n  },[token])\n  \n\n\n  useEffect(() => {\n    setToken(accessToken)\n    setJustLoggedIn(true)\n\n    let isCancelled = false\n\n    const fetchData = async () => {\n      try {\n        if(!isCancelled){\n          axios.defaults.baseURL = 'https://api.spotify.com/v1'\n          const { data } = await getCurrentUserProfile()\n          const fullName = data.display_name\n          const nameArray = fullName.split(' ')\n          const firstName = nameArray[0]\n          setFirstName(firstName)\n          const profPic = data.images[0].url\n          setProfilePhoto(profPic)\n          const location = data.country\n          setCountry(location)\n          const userEmail = data.email\n          setEmail(data.email)\n        }\n        \n      } catch(e) {\n        if(!isCancelled){\n          console.error(e);\n        }\n      }\n      \n\n      try {\n        if(!isCancelled){\n            axios.defaults.baseURL = 'https://api.spotify.com/v1'\n            const {data} = await getUserTopTracks()\n            const key = 0\n              setTopSongs(data.items)\n              const albumCover = data.items[key].album.images[0].url\n              setAlbumCover(albumCover)\n              const myTrack = data.items[key].name\n              setTopTrack(myTrack)\n              const myArtist = data.items[key].artists[0].name\n              setArtist(myArtist)\n              const preview = data.items[key].preview_url\n              setPreviewUrl(preview)\n              setTopTrack(\n                {\n                song: myTrack,\n                artist: myArtist,\n                albumCover: albumCover,\n                preview: preview\n              })      \n            }\n          }\n      catch(e) {\n        if(!isCancelled){\n          console.error(e)\n        }\n      }\n\n      try {\n        if(!isCancelled){\n            axios.defaults.baseURL = 'https://api.spotify.com/v1'            \n            const {data} = await getUserTopArtists()\n            setArtist(data.items[0].name)\n            setGenre([data.items[0].genres[0], data.items[0].genres[1]])\n            setArtistImage(data.items[0].images[0].url)\n            setArtistId(data.items[0].id)\n\n          }\n        }\n      catch(e) {\n        if(!isCancelled){\n          console.error(e)\n        }\n      }\n\n    }\n\n    catchErrors(fetchData())    \n\n    return () => {\n      isCancelled = true\n    }\n\n  }, []);\n\n \n  useEffect(() => {\n\n    let isCancelled = false\n\n    const postData = async() => {\n      try{ \n        if(!isCancelled){\n          axios.defaults.baseURL = process.env.REACT_APP_URL \n\n          axios.post('/users', {\n          name: firstName,\n          email: email,\n          country: country,\n          photo: profilePhoto,\n          topTrack: topTrack,\n          artist: artist,\n          artistImage: artistImage,\n          genre: genre\n        })\n        console.log(\"posted idk\")\n\n      }\n    } catch(error){\n\n      if(!isCancelled){\n        console.log(error)\n        console.log(\"not posted\")\n\n      }\n\n    }\n    }\n\n    postData()\n\n  return () => {\n    isCancelled = true\n  }\n\n\n\n  }, [])\n\n\n    const logout = () => {\n        setToken(\"\")\n        window.localStorage.removeItem(\"token\")\n    }\n\n\n\n  const user = {\n    token: token,\n    firstName: firstName,\n    profilePhoto: profilePhoto,\n    country: country,\n    topSongs: topSongs,\n    topTrack: topTrack,\n    artist: artist,\n    artistImage: artistImage,\n    artistId,\n    genre: genre,\n    preview: previewUrl,\n    albumCover: albumCover,\n    isPlaying: isPlaying,\n    similarArtists: similarArtists,\n    points: points\n  }\n\n\n  function ErrorHandler({error}){\n    return(\n      <div role=\"alert\">\n        <p>An error occured</p>\n        <pre>{error.message}</pre>\n      </div>\n    )\n  }\n\n\n  return(\n    !token ? \n      <LandingPage />\n      :\n    <Router>\n      <ErrorBoundary FallbackComponent={ErrorHandler}>\n    <div className=\"wrapper\">\n    <UserContext.Provider value={user && user}>\n        <div>\n          <Header \n          />\n        </div>\n        <div className=\"main\">\n          \n          <Main \n            />\n        </div>\n    </UserContext.Provider>\n\n      </div>\n      </ErrorBoundary>\n    </Router>\n\n  )\n}"]},"metadata":{},"sourceType":"module"}